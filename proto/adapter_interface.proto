syntax = "proto3";

package adapter;

// === CloudAdapter Service Definition ===
service CloudAdapter {
  rpc GetStatus(StatusRequest) returns (StatusResponse);
  rpc CreateGroupWithLeaders(CreateGroupWithLeadersRequest) returns (GroupCreatedResponse);
  rpc CreateUsersForGroup(CreateUsersForGroupRequest) returns (CreateUsersForGroupResponse);
  rpc GroupExists(GroupExistsRequest) returns (GroupExistsResponse);
  rpc GetTotalCostForGroup(CostRequest) returns (CostResponse);
  rpc GetTotalCostsForAllGroups(CostRequest) returns (AllGroupsCostResponse);
  rpc GetTotalCost(CostRequest) returns (CostResponse);
  rpc GetGroupCostWithServiceBreakdown(GroupServiceBreakdownRequest) returns (GroupServiceBreakdownResponse);
  rpc GetResourceCount(ResourceCountRequest) returns (ResourceCountResponse);
  // Koszty dla grupy z ostatnich 6 miesięcy w podziale na typy zasobów (mapa skrót_typu -> koszt)
  rpc GetGroupCostsLast6MonthsByService(GroupLast6MonthsCostRequest) returns (GroupCostMapResponse);
  // Całkowite koszty dla grupy w ujęciu miesięcznym z ostatnich 6 miesięcy (mapa YYYY-MM -> koszt)
  rpc GetGroupMonthlyCostsLast6Months(GroupLast6MonthsCostRequest) returns (GroupMonthlyCostsResponse);
  rpc CleanupGroupResources(CleanupGroupRequest) returns (CleanupGroupResponse);
  rpc RemoveGroup(RemoveGroupRequest) returns (RemoveGroupResponse);
  // Lista obsługiwanych typów zasobów, np. ["ec2", "s3"].
  rpc GetSupportedResourceTypes(SupportedResourceTypesRequest) returns (SupportedResourceTypesResponse);
}

// === Health Check ===
message StatusRequest {}

message StatusResponse {
  bool isHealthy = 1;
}

// === Group Management ===
message CreateGroupWithLeadersRequest {
  string resourceType = 1;
  repeated string leaders = 2;
  string groupName = 3;
}

message GroupCreatedResponse {
  string groupName = 1;
}

message CreateUsersForGroupRequest {
  repeated string users = 1;
  string groupName = 2;
}

message CreateUsersForGroupResponse {
  string message = 1;
}

message GroupExistsRequest {
  string groupName = 1;
}

message GroupExistsResponse {
  bool exists = 1;
}

// === Cost Queries ===
message CostRequest {
  string startDate = 1;
  string endDate = 2;
  string groupName = 3;
}

message CostResponse {
  double amount = 1;
}

message GroupCost {
  string groupName = 1;
  double amount = 2;
}

message AllGroupsCostResponse {
  repeated GroupCost groupCosts = 1;
}

// === Detailed Breakdown ===
message GroupServiceBreakdownRequest {
  string groupName = 1;
  string startDate = 2;
  string endDate = 3;
}

message ServiceCost {
  string serviceName = 1;
  double amount = 2;
}

message GroupServiceBreakdownResponse {
  double total = 1;
  repeated ServiceCost breakdown = 2;
}

// === 6-miesięczne koszty w formie mapy ===
message GroupLast6MonthsCostRequest {
  string groupName = 1;
}

message GroupCostMapResponse {
  map<string, double> costs = 1; // np. {"ec2": 1002.23, "s3": 13.30}
}

// === 6-miesięczne koszty całkowite miesiąc-po-miesiącu ===
message GroupMonthlyCostsResponse {
  // Klucze w formacie dd-MM-yyyy (zawsze pierwszy dzień miesiąca, np. "01-07-2025").
  // Zawsze 6 pozycji, łącznie z bieżącym miesiącem (UTC).
  map<string, double> monthCosts = 1;
}

// === Resource counting ===
message ResourceCountRequest {
  string groupName = 1;
  string resourceType = 2;
}

message ResourceCountResponse {
  int32 count = 1;
}

// === Resource Cleanup ===
message CleanupGroupRequest {
  string groupName = 1;
  bool force = 2;
}

message CleanupGroupResponse {
  bool success = 1;
  repeated string deletedResources = 2;
  string message = 3;
}

// === Group removal ===
message RemoveGroupRequest {
  string groupName = 1;
}

message RemoveGroupResponse {
  bool success = 1;
  repeated string removedUsers = 2;
  string message = 3;
}

// === Supported resource types ===
message SupportedResourceTypesRequest {}

message SupportedResourceTypesResponse {
  repeated string resourceTypes = 1; // np. ["ec2", "s3", "iam"]
}
